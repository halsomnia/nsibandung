<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Order</title> 

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            --primary-color: #000000; 
            --secondary-color: #000000; 
            --accent-color: #FFFF00; 
            --bg-light: #f4f7f6;      
            --bg-card: #ffffff;       
            --text-dark: #212121;     
            --shadow-subtle: 0 4px 10px rgba(0, 0, 0, 0.08); 
            --header-bg: var(--primary-color);
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-light);
            display: flex;
            justify-content: center;
            padding: 10px; 
            margin: 0;
            font-size: 12px; 
            -webkit-text-size-adjust: 100%; 
            color: var(--text-dark);
        }

        .sales-order-container {
            width: 100%;
            max-width: 900px; 
            background: var(--bg-card);
            box-shadow: var(--shadow-subtle); 
            border-radius: 12px; 
            overflow: hidden; 
        }

        h2 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px; 
            background-color: var(--header-bg); 
            color: white;
            margin: 0;
            font-size: 18px; 
            letter-spacing: 1px;
        }

        #grand-total-display {
            color: var(--accent-color);
            font-weight: 700;
        }

        .header-info {
            padding: 12px; 
            background-color: var(--bg-card); 
            border-bottom: 1px solid #e0e0e0; 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px; 
        }

        .info-row {
            display: flex;
            align-items: center;
            flex: 1 1 100%; 
            font-size: 12px;
        }
        @media (min-width: 500px) {
             .info-row {
                flex: 1 1 45%; 
            }
        }

        .info-row label {
            font-weight: 600;
            min-width: 70px; 
            color: var(--text-dark);
            white-space: nowrap; 
        }

        .info-row input[type="text"] {
            flex-grow: 1; 
            padding: 8px 10px; 
            border: 1px solid #e0e0e0;
            border-radius: 6px; 
            font-size: 12px; 
            transition: border-color 0.2s;
        }
        .info-row input[type="text"]:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .filter-bar {
            padding: 10px 12px; 
            font-size: 11px; 
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px; 
        }
        
        #review-btn-trigger {
            padding: 8px 16px; 
            font-size: 12px; 
            border-radius: 6px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #review-btn-trigger:disabled {
            background-color: #ced4da; 
            cursor: not-allowed;
            opacity: 0.8;
        }

        .table-wrapper {
            max-height: 75vh; 
            overflow-y: auto; 
            border-radius: 0 0 12px 12px; 
        }

        table {
            width: 100%;
            border-collapse: separate; 
            border-spacing: 0; 
            table-layout: fixed; 
            font-size: 11px; 
        }

        thead th:nth-child(1) { width: 30%; } 
        thead th:nth-child(2) { width: 8%; } 
        thead th:nth-child(6) { width: 38%; } 

        thead {
            background-color: var(--primary-color);
            color: white;
            position: sticky; 
            top: 0;
            z-index: 10;
        }
        
        thead th {
            font-weight: 600;
            padding: 8px 3px; 
            border: none; 
            border-bottom: 1px solid #444444; 
        }

        th, td {
            padding: 6px 3px; 
            height: auto; 
            border: none; 
            border-bottom: 1px solid #eeeeee; 
        }
        
        .product-row:last-child td {
            border-bottom: none; 
        }
        
        .text-left { text-align: left; padding-left: 5px; }
        .text-right { text-align: right; padding-right: 5px; font-weight: 500; }

        .order-input, .disc-input {
            width: 100%; 
            max-width: 45px; 
            padding: 3px 22px 3px 3px; 
            font-size: 11px; 
            height: 24px; 
            margin: auto; 
            display: block;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
        }
        
        .order-input::placeholder {
            color: #888;
            opacity: 1;
            font-size: 10px;
        }
		
		.order-input:disabled {
			border: none;
			background: transparent;
		}
        
        .order-input:disabled::placeholder {
            color: transparent;
        }
		
        .disc-input { max-width: 40px; }
        
        .product-group-header td {
            background-color: var(--secondary-color) !important; 
            color: white;
            font-weight: 700;
            padding: 8px 10px !important; 
        }
        
        .KEM-TONE-EXT-row, .KEM-TONE-INT-row, .ULTRASHIELD-row, .SPECTRUM-row,
        .COLORTONE-EXT-row, .COLORTONE-INT-row, .SPECTRUM-SWOB-row, .SPECTRUM-ECO-row,
        .AEROSOL-row, .COLORANT-row, .ABC-row, .TAMITEX-CT-row, .TAMITEX-WF-row,
        .TAMITEX-CG-row, .VINOTEX-CT-row, .VINOTEX-WF-row, .APOLLO-row,
        .SPECTRUM-GRANITE-row, .SPECTRUM-FLOORKOTE-row { background-color: #f9f9f9; } 

        #review-page {
            display: none; 
            background-color: white;
        }

        #capture-area {
            background-color: white;
            padding: 38px;
            color: var(--text-dark);
            width: fit-content;
            min-width: 100%;
            box-sizing: border-box;
        }
        
        .review-header-title {
            font-size: 26px;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .review-info-table {
            width: 100%;
            margin-bottom: 20px;
            font-size: 13px;
        }
        .review-info-table td {
            padding: 2px 0;
            border: none;
        }
        .review-label {
            width: 80px;
            color: black;
        }
        .review-value {
            font-weight: bold;
            text-transform: uppercase;
            color: black;
        }

        .review-scroll-wrapper {
            width: 100%;
            overflow-x: auto;
        }

        .review-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
            table-layout: auto; 
            color: black;
        }

        .review-table th {
            background-color: black; 
            color: white;
            font-weight: bold;
            text-align: center;
            border: none;
            border-bottom: 1px solid white;
            padding: 8px 5px;
            vertical-align: middle;
            text-transform: uppercase;
        }

        .review-table td {
            border: none; 
            border-bottom: 1px solid #e0e0e0; 
            padding: 8px 5px;
            color: black;
        }
        
        .rev-col-product-group { 
            text-align: left; 
            font-weight: normal;
            min-width: 90px;
            white-space: normal;
        }
        .rev-col-product-cat { 
            text-align: left; 
            font-weight: normal;
            min-width: 110px;
            white-space: normal;
        }
        .rev-col-disc { 
            text-align: center; 
            min-width: 45px;
            white-space: normal;
        }
        .rev-col-qty { 
            text-align: center;           
            min-width: 120px;           /* diperlebar sedikit supaya muat 2-3 item */
            white-space: normal;
            padding-left: 8px;          /* sedikit indent agar lebih rapi */
        }
        .rev-col-total { 
            text-align: right; 
            width: auto;
            white-space: nowrap;
            font-weight: bold;
            padding-left: 10px !important;
        }

        .review-grand-total-row td {
            border: none;
            padding: 0;
            height: 30px;
        }

        .bg-black-total {
            background-color: transparent !important; 
            color: black !important; 
            font-weight: bold;
            font-size: 16px; 
            text-align: right;
            padding: 10px 0px !important; 
            border: none !important;
            white-space: nowrap;
        }

        .review-notes-section {
            margin-top: 15px;
            padding-top: 5px;
            width: 100%;
        }
        .review-notes-section label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 12px;
            color: black;
        }
        .review-notes-section textarea {
            width: 100%;
            min-height: 40px;
            padding: 8px 0;
            border: none;
            border-radius: 0;
            background: transparent;
            font-family: inherit;
            font-size: 12px;
            resize: none;
            box-sizing: border-box;
            line-height: 1.4;
            color: black;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow: hidden;
        }

        .review-actions {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            padding-bottom: 20px;
        }

        .btn-action {
            padding: 10px 20px;
            font-size: 14px;
            font-weight: bold;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            color: white;
            width: 45%; 
            max-width: 150px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .btn-edit { background-color: #ff9800; } 
        .btn-save-jpg { background-color: #28a745; } 
    </style>
</head>
<body>

<div class="sales-order-container">
    
    <div id="main-form">
        <h2>
            <span>Sales Order (HB FEB2026)</span>
            <span id="grand-total-display">0</span>
        </h2> 
        
        <div class="header-info">
            <div class="info-row">
                <label for="nama-toko">Toko:</label>
                <input type="text" id="nama-toko" placeholder="Nama dan Alamat Toko">
            </div>
            <div class="info-row">
                <label for="salesman">Salesman:</label>
                <input type="text" id="salesman" placeholder="Nama Salesman">
            </div>
        </div>
        
        <div class="filter-bar">
            <label for="filter-active">
                <input type="checkbox" id="filter-active"> 
                Tampilkan pesanan yang terisi
            </label>
            <button id="review-btn-trigger" disabled>Simpan</button>
        </div>
        
        <div class="table-wrapper" id="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th class="text-left">PRODUK</th>
                        <th>DISC</th>
                        <th colspan="3">ORDER (QTY)</th>
                        <th>TOTAL (RP)</th>
                    </tr>
                </thead>
                <tbody id="product-list"></tbody>
            </table>
        </div>
    </div>

    <div id="review-page">
        <div class="review-scroll-wrapper">
            <div id="capture-area">
                <div class="review-header-title">Sales Order</div>
                
                <table class="review-info-table">
                    <tr>
                        <td class="review-label">Toko</td>
                        <td class="review-value" id="review-toko">-</td>
                    </tr>
                    <tr>
                        <td class="review-label">Salesman</td>
                        <td class="review-value" id="review-salesman">-</td>
                    </tr>
                </table>

                <table class="review-table">
                    <thead>
                        <tr>
                            <th rowspan="2" colspan="2">Produk</th> 
                            <th rowspan="2">DISC</th>
                            <th rowspan="2">ORDER (QTY)</th>
                            <th rowspan="2">TOTAL (RP)</th>
                        </tr>
                    </thead>
                    <tbody id="review-table-body"></tbody>
                    <tfoot>
                        <tr class="review-grand-total-row">
                            <td colspan="4" style="border:none;"></td> 
                            <td id="review-grand-total" class="bg-black-total">0</td>
                        </tr>
                    </tfoot>
                </table>

                <div class="review-notes-section">
                    <label for="catatan-so">Catatan:</label>
                    <textarea id="catatan-so" placeholder="Tulis kode warna, voucher, atau apapun di sini..." rows="3"></textarea>
                </div>
            </div>
        </div>

        <div class="review-actions">
            <button class="btn-action btn-edit" id="btn-edit">Edit</button>
            <button class="btn-action btn-save-jpg" id="btn-save-jpg">Simpan JPG</button>
        </div>
    </div>

</div>

<script>
    const productData = [
        { produk: "KEM-TONE EXT", kategori: "WHITE EXT", hargaKg: 0, hargaGln: 579900, hargaPl: 2823600, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "KEM-TONE EXT", kategori: "ALKALI", hargaKg: 0, hargaGln: 438300, hargaPl: 2019300, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "KEM-TONE EXT", kategori: "TBM", hargaKg: 0, hargaGln: 498300, hargaPl: 2469500, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "KEM-TONE EXT", kategori: "UWE", hargaKg: 0, hargaGln: 510300, hargaPl: 2539100, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "KEM-TONE EXT", kategori: "DBO", hargaKg: 0, hargaGln: 472400, hargaPl: 2200500, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "KEM-TONE EXT", kategori: "NBT", hargaKg: 0, hargaGln: 416200, hargaPl: 1928000, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
		
        { produk: "KEM-TONE INT", kategori: "WHITE INT", hargaKg: 0, hargaGln: 392700, hargaPl: 1875300, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "KEM-TONE INT", kategori: "ALKALI", hargaKg: 0, hargaGln: 337500, hargaPl: 1557100, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "KEM-TONE INT", kategori: "TBA", hargaKg: 0, hargaGln: 349400, hargaPl: 1674700, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "KEM-TONE INT", kategori: "UWI", hargaKg: 0, hargaGln: 392700, hargaPl: 1901600, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "KEM-TONE INT", kategori: "DBC", hargaKg: 94100, hargaGln: 334200, hargaPl: 1499500, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "KEM-TONE INT", kategori: "NBD", hargaKg: 93100, hargaGln: 318300, hargaPl: 1479000, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "KEM-TONE INT", kategori: "3 IN 1", hargaKg: 0, hargaGln: 473100, hargaPl: 2233000, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "KEM-TONE INT", kategori: "ULTRA PRIMER", hargaKg: 0, hargaGln: 473100, hargaPl: 2233000, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "KEM-TONE INT", kategori: "CAT GYPSUM", hargaKg: 0, hargaGln: 249800, hargaPl: 1194500, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "KEM-TONE INT", kategori: "WALL FILLER", hargaKg: 0, hargaGln: 176600, hargaPl: 762400, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "KEM-TONE INT", kategori: "WALL SEALER (SOLVENT)", hargaKg: 0, hargaGln: 311000, hargaPl: 1431000, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "KEM-TONE INT", kategori: "PAINT REMOVER (SOLVENT)", hargaKg: 91300, hargaGln: 308600, hargaPl: 1500700, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "KEM-TONE INT", kategori: "TECHNIQUE GLAZE", hargaKg: 73300, hargaGln: 261800, hargaPl: 0, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "KEM-TONE INT", kategori: "RUSH REMOVER", hargaKg: 0, hargaGln: 279800, hargaPl: 1054200, disc: 17.5, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
		
        { produk: "ULTRASHIELD", kategori: "PUTIH", hargaKg: 0, hargaGln: 389600, hargaPl: 1856600, disc: 15.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "ULTRASHIELD", kategori: "ULTRA PRIMER", hargaKg: 0, hargaGln: 411700, hargaPl: 1960400, disc: 15.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "ULTRASHIELD", kategori: "TBM", hargaKg: 0, hargaGln: 379300, hargaPl: 1785500, disc: 15.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "ULTRASHIELD", kategori: "DBO", hargaKg: 0, hargaGln: 329400, hargaPl: 1544100, disc: 15.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "ULTRASHIELD", kategori: "NBT", hargaKg: 0, hargaGln: 323400, hargaPl: 1450800, disc: 15.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
		
        { produk: "SPECTRUM", kategori: "ALKALI", hargaKg: 0, hargaGln: 205300, hargaPl: 938900, disc: 15.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "SPECTRUM", kategori: "CAT GYPSUM", hargaKg: 0, hargaGln: 186700, hargaPl: 888700, disc: 15.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "SPECTRUM", kategori: "PUTIH", hargaKg: 0, hargaGln: 210000, hargaPl: 1006500, disc: 15.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "SPECTRUM", kategori: "TBA", hargaKg: 0, hargaGln: 198300, hargaPl: 906200, disc: 15.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "SPECTRUM", kategori: "DBC", hargaKg: 51200, hargaGln: 174900, hargaPl: 777900, disc: 15.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "SPECTRUM", kategori: "NBD", hargaKg: 46500, hargaGln: 153500, hargaPl: 702100, disc: 15.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "SPECTRUM", kategori: "YB", hargaKg: 48900, hargaGln: 170100, hargaPl: 755800, disc: 15.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
		
        { produk: "COLORTONE EXT", kategori: "PUTIH EXT", hargaKg: 0, hargaGln: 218500, hargaPl: 995000, disc: 12.5, placeholderKg: "KG", placeholderGln: "3,5L", placeholderPl: "PL" },
        { produk: "COLORTONE EXT", kategori: "TBM", hargaKg: 0, hargaGln: 175900, hargaPl: 843600, disc: 12.5, placeholderKg: "KG", placeholderGln: "3,5L", placeholderPl: "PL" },
        { produk: "COLORTONE EXT", kategori: "DBO", hargaKg: 0, hargaGln: 155400, hargaPl: 729000, disc: 12.5, placeholderKg: "KG", placeholderGln: "3,5L", placeholderPl: "PL" },
        { produk: "COLORTONE EXT", kategori: "NBT", hargaKg: 0, hargaGln: 144400, hargaPl: 676100, disc: 12.5, placeholderKg: "KG", placeholderGln: "3,5L", placeholderPl: "PL" },
		
        { produk: "COLORTONE INT", kategori: "ALKALI", hargaKg: 104500, hargaGln: 145400, hargaPl: 706000, disc: 14.5, placeholderKg: "2,5L", placeholderGln: "3,5L", placeholderPl: "PL" },
        { produk: "COLORTONE INT", kategori: "PUTIH INT", hargaKg: 104500, hargaGln: 145400, hargaPl: 706000, disc: 14.5, placeholderKg: "2,5L", placeholderGln: "3,5L", placeholderPl: "PL" },
        { produk: "COLORTONE INT", kategori: "TBA", hargaKg: 96800, hargaGln: 132200, hargaPl: 606300, disc: 14.5, placeholderKg: "2,5L", placeholderGln: "3,5L", placeholderPl: "PL" },
        { produk: "COLORTONE INT", kategori: "DBC", hargaKg: 79600, hargaGln: 106500, hargaPl: 465900, disc: 14.5, placeholderKg: "2,5L", placeholderGln: "3,5L", placeholderPl: "PL" },
        { produk: "COLORTONE INT", kategori: "NBD", hargaKg: 68600, hargaGln: 91900, hargaPl: 416700, disc: 14.5, placeholderKg: "2,5L", placeholderGln: "3,5L", placeholderPl: "PL" },
		
        { produk: "SPECTRUM SW08", kategori: "ABU/PUTIH/OUTER SPACE", hargaKg: 65000, hargaGln: 245400, hargaPl: 1140000, disc: 15.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "SPECTRUM SW08", kategori: "MUDA", hargaKg: 56700, hargaGln: 203800, hargaPl: 1014500, disc: 15.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "SPECTRUM SW08", kategori: "NB", hargaKg: 51000, hargaGln: 180100, hargaPl: 852600, disc: 15.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
		
        { produk: "SPECTRUM ECO", kategori: "ALKALI", hargaKg: 0, hargaGln: 155300, hargaPl: 735800, disc: 15.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "SPECTRUM ECO", kategori: "PUTIH & READY MIX", hargaKg: 0, hargaGln: 176800, hargaPl: 803300, disc: 15.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
		
        { produk: "AEROSOL", kategori: "AEROSOL", hargaKg: 16500, hargaGln: 25800, hargaPl: 0, disc: 10.0, placeholderKg: "150CC", placeholderGln: "300CC", placeholderPl: "PL" },
		
        { produk: "COLORANT", kategori: "RED", hargaKg: 0, hargaGln: 371600, hargaPl: 0, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "COLORANT", kategori: "RED OXIDE", hargaKg: 0, hargaGln: 227200, hargaPl: 0, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "COLORANT", kategori: "YELLOW", hargaKg: 0, hargaGln: 245700, hargaPl: 0, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "COLORANT", kategori: "YELLOW OXIDE", hargaKg: 0, hargaGln: 206200, hargaPl: 0, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "COLORANT", kategori: "BLUE", hargaKg: 0, hargaGln: 165400, hargaPl: 0, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "COLORANT", kategori: "GREEN", hargaKg: 0, hargaGln: 406700, hargaPl: 0, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "COLORANT", kategori: "VIOLET", hargaKg: 0, hargaGln: 214800, hargaPl: 0, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "COLORANT", kategori: "RAW UMBER", hargaKg: 0, hargaGln: 110000, hargaPl: 0, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "COLORANT", kategori: "MAGENTA", hargaKg: 0, hargaGln: 282600, hargaPl: 0, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "COLORANT", kategori: "BLACK", hargaKg: 0, hargaGln: 161700, hargaPl: 0, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "COLORANT", kategori: "WHITE", hargaKg: 0, hargaGln: 266700, hargaPl: 0, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "COLORANT", kategori: "RED ORANGE", hargaKg: 0, hargaGln: 624200, hargaPl: 0, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "COLORANT", kategori: "PREMIUM YELLOW", hargaKg: 0, hargaGln: 1473900, hargaPl: 0, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
		
        { produk: "ABC", kategori: "STD", hargaKg: 0, hargaGln: 244000, hargaPl: 1282000, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "ABC", kategori: "STD", hargaKg: 37800, hargaGln: 63200, hargaPl: 0, disc: 10.0, placeholderKg: "0,4L", placeholderGln: "0,8L", placeholderPl: "PL" }, 
        { produk: "ABC", kategori: "SILVER", hargaKg: 45700, hargaGln: 82500, hargaPl: 0, disc: 10.0, placeholderKg: "0,4L", placeholderGln: "0,8L", placeholderPl: "PL" },
        { produk: "ABC", kategori: "COPPER", hargaKg: 47300, hargaGln: 82500, hargaPl: 0, disc: 10.0, placeholderKg: "0,4L", placeholderGln: "0,8L", placeholderPl: "PL" },
		{ produk: "ABC", kategori: "GOLD", hargaKg: 72500, hargaGln: 126000, hargaPl: 0, disc: 10.0, placeholderKg: "0,4L", placeholderGln: "0,8L", placeholderPl: "PL" },
		
        { produk: "TAMITEX CT", kategori: "TAMITEX CT", hargaKg: 28900, hargaGln: 117900, hargaPl: 541700, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },

        { produk: "TAMITEX WF", kategori: "TAMITEX WF", hargaKg: 19700, hargaGln: 62400, hargaPl: 320000, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },

        { produk: "TAMITEX CG", kategori: "SPC", hargaKg: 76300, hargaGln: 259600, hargaPl: 1294400, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "TAMITEX CG", kategori: "STD", hargaKg: 64300, hargaGln: 205500, hargaPl: 1013005, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },

        { produk: "VINOTEX CT", kategori: "STD & VIP", hargaKg: 22000, hargaGln: 82100, hargaPl: 337600, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
        { produk: "VINOTEX CT", kategori: "SPC", hargaKg: 27200, hargaGln: 99300, hargaPl: 420800, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
		
        { produk: "VINOTEX WF", kategori: "VINOTEX WF", hargaKg: 17400, hargaGln: 52000, hargaPl: 243800, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },

        { produk: "APOLLO", kategori: "APOLLO", hargaKg: 0, hargaGln: 60800, hargaPl: 235800, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },

        { produk: "SPECTRUM GRANITE", kategori: "SPECTRUM GRANITE", hargaKg: 0, hargaGln: 448200, hargaPl: 2106000, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
		
        { produk: "SPECTRUM FLOORKOTE", kategori: "SPECTRUM FLOORKOTE", hargaKg: 75000, hargaGln: 250000, hargaPl: 1130000, disc: 10.0, placeholderKg: "KG", placeholderGln: "GLN", placeholderPl: "PL" },
    ];
    
    function formatRupiah(number) {
        if (number === 0 || isNaN(number)) return '-'; 
        return Math.round(number).toLocaleString('id-ID', { minimumFractionDigits: 0 });
    }
    
    function createTableRows(data) {
        let html = '';
        let lastProduct = '';

        data.forEach((item, index) => {
            const cssClassName = item.produk.replace(/\s/g, '-').replace(/\//g, '-').toUpperCase();
            
            if (item.produk && item.produk !== lastProduct) {
                lastProduct = item.produk;
                const headerClassName = cssClassName + '-header';
                html += `<tr class="product-group-header ${headerClassName}">`;
                html += `<td colspan="5" class="group-label text-left">${item.produk}</td>`; 
                html += `<td class="text-right">-</td>`;
                html += `</tr>`;
            }
            
            let rowHtml = `<tr class="product-row ${cssClassName}-row" data-index="${index}">`; 
            rowHtml += `<td class="text-left row-category">${item.kategori}</td>`; 
            rowHtml += `<td><input type="number" min="0" max="100" value="${item.disc}" class="disc-input" step="0.5"></td>`;
            
            const disabledKg = item.hargaKg > 0 ? '' : 'disabled';
            const disabledGln = item.hargaGln > 0 ? '' : 'disabled';
            const disabledPl = item.hargaPl > 0 ? '' : 'disabled';

            rowHtml += `<td><input type="number" min="0" value="" placeholder="${item.placeholderKg}" ${disabledKg} class="order-input kg-qty" data-price="${item.hargaKg}"></td>`;
            rowHtml += `<td><input type="number" min="0" value="" placeholder="${item.placeholderGln}" ${disabledGln} class="order-input gln-qty" data-price="${item.hargaGln}"></td>`;
            rowHtml += `<td><input type="number" min="0" value="" placeholder="${item.placeholderPl}" ${disabledPl} class="order-input pl-qty" data-price="${item.hargaPl}"></td>`;
            rowHtml += `<td class="total-row text-right" data-total="0">-</td>`;
            rowHtml += `</tr>`;
            html += rowHtml;
        });

        document.getElementById('product-list').innerHTML = html;
        attachEventListeners();
    }
    
    function applyRowFilter(row, total) {
        const filterActive = document.getElementById('filter-active').checked;
        const isProductRow = row.classList.contains('product-row');
        if (filterActive) {
            if (isProductRow && total === 0) {
                row.style.display = 'none'; 
            } else {
                row.style.display = ''; 
            }
            if (row.classList.contains('product-group-header')) {
                 row.style.display = '';
            }
        } else {
            row.style.display = ''; 
        }
    }

    function calculateRow(row) {
        const inputKg   = row.querySelector('.kg-qty');
        const inputGln  = row.querySelector('.gln-qty');
        const inputPl   = row.querySelector('.pl-qty');
        const inputDisc = row.querySelector('.disc-input'); 

        if (!inputKg) return; 

        const hargaKg = parseFloat(inputKg.dataset.price)  || 0;
        const qtyKg   = parseFloat(inputKg.value)   || 0; 
        const hargaGln = parseFloat(inputGln.dataset.price) || 0;
        const qtyGln   = parseFloat(inputGln.value)  || 0;
        const hargaPl  = parseFloat(inputPl.dataset.price)  || 0;
        const qtyPl    = parseFloat(inputPl.value)   || 0;
        const discPercent = parseFloat(inputDisc.value) || 0; 
        
        let total = ((hargaKg * qtyKg) + (hargaGln * qtyGln) + (hargaPl * qtyPl)) * (1 - (discPercent / 100));
        total = Math.round(total); 

        const totalDisplayElement = row.querySelector('.total-row');
        totalDisplayElement.dataset.total = total; 
        totalDisplayElement.textContent = formatRupiah(total);

        applyRowFilter(row, total);
        calculateGrandTotal();
    }

    function calculateGrandTotal() {
        let grandTotal = 0;
        const totalElements = document.querySelectorAll('.total-row');
        const reviewBtn = document.getElementById('review-btn-trigger'); 
        
        totalElements.forEach(element => {
            grandTotal += parseFloat(element.dataset.total) || 0;
        });

        document.getElementById('grand-total-display').textContent = formatRupiah(grandTotal);
        reviewBtn.disabled = grandTotal === 0;
    }

    function toggleFilter() {
        const allRows = document.querySelectorAll('#product-list > tr');
        allRows.forEach(row => {
            if (row.classList.contains('product-row')) {
                const total = parseFloat(row.querySelector('.total-row').dataset.total) || 0;
                applyRowFilter(row, total);
            }
        });

        const filterActive = document.getElementById('filter-active').checked;
        let visibleProductGroups = {}; 

        document.querySelectorAll('.product-row').forEach(row => {
            if (row.style.display !== 'none') {
                visibleProductGroups[row.classList[1].replace('-row', '')] = true;
            }
        });
        
        document.querySelectorAll('.product-group-header').forEach(headerRow => {
            const productClass = headerRow.classList[1].replace('-header', '');
            if (filterActive && !visibleProductGroups[productClass]) {
                headerRow.style.display = 'none';
            } else {
                headerRow.style.display = '';
            }
        });
        
        calculateGrandTotal(); 
    }
    
    function showReviewPage() {
        const namaToko = document.getElementById('nama-toko').value.trim() || "-";
        const salesman = document.getElementById('salesman').value.trim() || "-";

        document.getElementById('review-toko').textContent = namaToko;
        document.getElementById('review-salesman').textContent = salesman;

        const tbody = document.getElementById('review-table-body');
        tbody.innerHTML = '';
        
        let currentGrandTotal = 0;
        const rows = document.querySelectorAll('.product-row');

        rows.forEach(row => {
            const total = parseFloat(row.querySelector('.total-row').dataset.total) || 0;
            
            if (total > 0) {
                currentGrandTotal += total;
                const dataIndex = row.dataset.index;
                const productObj = productData[dataIndex];
                
                const discVal = row.querySelector('.disc-input').value;
                const kgVal  = row.querySelector('.kg-qty').value.trim();
                const glnVal = row.querySelector('.gln-qty').value.trim();
                const plVal  = row.querySelector('.pl-qty').value.trim();
                
                let qtyParts = [];
                if (kgVal)  qtyParts.push(`${kgVal} (${productObj.placeholderKg})`);
                if (glnVal) qtyParts.push(`${glnVal} (${productObj.placeholderGln})`);
                if (plVal)  qtyParts.push(`${plVal} (${productObj.placeholderPl})`);
                
                const qtyDisplay = qtyParts.join(' , ').trim();  // ‚Üê pemisah strip dengan spasi di sekitarnya

                let tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="rev-col-product-group">${productObj.produk}</td>
                    <td class="rev-col-product-cat">${productObj.kategori}</td>
                    <td class="rev-col-disc">${discVal.replace('.', ',')}%</td>
                    <td class="rev-col-qty">${qtyDisplay || ''}</td>
                    <td class="rev-col-total">${formatRupiah(total)}</td>
                `;
                tbody.appendChild(tr);
            }
        });

        document.getElementById('review-grand-total').textContent = formatRupiah(currentGrandTotal);

        document.getElementById('main-form').style.display = 'none';
        document.getElementById('review-page').style.display = 'block';

        const catatanArea = document.getElementById('catatan-so');
        catatanArea.style.height = 'auto';
        catatanArea.style.height = (catatanArea.scrollHeight) + 'px';
    }

    function hideReviewPage() {
        document.getElementById('review-page').style.display = 'none';
        document.getElementById('main-form').style.display = 'block';
    }

    async function saveReviewAsJpg() {
        const captureElement = document.getElementById('capture-area');
        const namaToko = document.getElementById('nama-toko').value.trim() || "SO"; 
        const catatanArea = document.getElementById('catatan-so');
        
        const parent = catatanArea.parentNode;
        const originalValue = catatanArea.value;

        const textReplacement = document.createElement('div');
        textReplacement.style.width = '100%';
        textReplacement.style.fontSize = '12px';
        textReplacement.style.fontFamily = 'inherit';
        textReplacement.style.color = 'black';
        textReplacement.style.whiteSpace = 'pre-wrap';
        textReplacement.style.wordWrap = 'break-word';
        textReplacement.style.paddingTop = '5px';
        textReplacement.innerText = originalValue || "-";

        catatanArea.style.display = 'none';
        parent.appendChild(textReplacement);

        try {
            const canvas = await html2canvas(captureElement, {
                scale: 2, 
                backgroundColor: '#ffffff',
                useCORS: true,
                width: captureElement.scrollWidth,
                height: captureElement.scrollHeight,
                windowWidth: captureElement.scrollWidth,
                windowHeight: captureElement.scrollHeight,
                x: 0,
                y: 0
            });

            const imageURL = canvas.toDataURL('image/jpeg', 0.95);
            
            const downloadLink = document.createElement('a');
            downloadLink.href = imageURL;
            downloadLink.download = `SO_${namaToko.replace(/\s/g, '_').toUpperCase()}_${new Date().toISOString().slice(0, 10)}.jpg`;
            
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);

        } catch (error) {
            console.error("Gagal save JPG:", error);
            alert("Gagal menyimpan gambar. Silakan coba lagi.");
        } finally {
            parent.removeChild(textReplacement);
            catatanArea.style.display = 'block';
        }
    }

    function attachEventListeners() {
        const qtyInputs = document.querySelectorAll('.order-input');
        const discInputs = document.querySelectorAll('.disc-input');
        
        [...qtyInputs, ...discInputs].forEach(input => {
            input.addEventListener('input', function() {
                if (this.classList.contains('disc-input')) {
                    if (parseFloat(this.value) > 100) this.value = 100; 
                } 
                if (parseFloat(this.value) < 0) this.value = 0; 
                
                calculateRow(this.closest('.product-row'));
            });
            calculateRow(input.closest('.product-row'));
        });
        
        document.getElementById('filter-active').addEventListener('change', toggleFilter);
        document.getElementById('review-btn-trigger').addEventListener('click', showReviewPage);
        document.getElementById('btn-edit').addEventListener('click', hideReviewPage);
        document.getElementById('btn-save-jpg').addEventListener('click', saveReviewAsJpg);

        const catatanArea = document.getElementById('catatan-so');
        catatanArea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        createTableRows(productData);
    });
</script>
</body>
</html>

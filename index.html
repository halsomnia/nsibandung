<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SALES ORDER</title> 

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* ==================== 1. CSS STYLING UMUM (MINIMALIS & MODERN) ==================== */
        :root {
            --primary-color: #000000; /* Teal - Modern, Clean */
            --secondary-color: #000000; /* Blue Grey - Untuk Total/Grup Header */
            --accent-color: #FFFF00; /* Orange - Untuk Highlight Nilai Total */
            --bg-light: #f4f7f6;      /* Background umum (abu-abu sangat terang) */
            --bg-card: #ffffff;       /* Background kontainer utama (putih murni) */
            --text-dark: #212121;     /* Warna teks utama */
            --shadow-subtle: 0 4px 10px rgba(0, 0, 0, 0.08); 
            --header-bg: var(--primary-color);
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-light);
            display: flex;
            justify-content: center;
            padding: 10px; 
            margin: 0;
            font-size: 12px; 
            -webkit-text-size-adjust: 100%; 
            color: var(--text-dark);
        }

        .sales-order-container {
            width: 100%;
            max-width: 900px; 
            background: var(--bg-card);
            box-shadow: var(--shadow-subtle); 
            border-radius: 12px; 
            overflow: hidden; 
        }

        /* --- HEADER UTAMA --- */
        h2 {
            text-align: center;
            padding: 15px 0; 
            background-color: var(--header-bg); 
            color: white;
            margin: 0;
            font-size: 18px; 
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        /* --- HEADER INFO STYLING (FORM) --- */
        .header-info {
            padding: 12px; 
            background-color: var(--bg-card); 
            border-bottom: 1px solid #e0e0e0; /* Border sangat halus */
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px; 
        }

        .info-row {
            display: flex;
            align-items: center;
            flex: 1 1 100%; 
            font-size: 12px;
        }
        @media (min-width: 500px) {
             .info-row {
                flex: 1 1 45%; 
            }
        }

        .info-row label {
            font-weight: 600;
            min-width: 70px; 
            color: var(--text-dark);
            white-space: nowrap; 
        }

        .info-row input[type="text"] {
            flex-grow: 1; 
            padding: 8px 10px; 
            border: 1px solid #e0e0e0;
            border-radius: 6px; 
            font-size: 12px; 
            transition: border-color 0.2s;
        }
        .info-row input[type="text"]:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        /* --- STYLING GRAND TOTAL BAR --- */
        .grand-total-top {
            padding: 12px 15px; 
            background-color: var(--secondary-color); 
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }

        .grand-total-label {
            font-size: 14px; 
            font-weight: 600;
            text-transform: uppercase;
        }

        .grand-total-value {
            color: var(--accent-color); 
            font-size: 22px; 
            font-weight: 700;
        }

        /* --- FILTER BAR STYLING --- */
        .filter-bar {
            padding: 10px 12px; 
            font-size: 11px; 
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px; 
        }
        
        #download-btn {
            padding: 8px 16px; 
            font-size: 12px; 
            border-radius: 6px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.2s;
        }
        #download-btn:hover:not(:disabled) {
            background-color: #007bff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        #download-btn:disabled {
            background-color: #ced4da; 
            cursor: not-allowed;
            opacity: 0.8;
            box-shadow: none;
        }

        /* --- TABLE STYLING: NO BORDERS & CLEAN --- */
        .table-wrapper {
            max-height: 75vh; 
            overflow-y: auto; 
            border-radius: 0 0 12px 12px; 
        }

        table {
            width: 100%;
            border-collapse: separate; 
            border-spacing: 0; 
            table-layout: fixed; 
            font-size: 11px; 
        }

        /* --- PENGATURAN LEBAR KOLOM (MOBILE OPTIMIZED) --- */
        thead th:nth-child(1) { width: 30%; } 
        thead th:nth-child(2) { width: 8%; } 
        thead tr:nth-child(2) th:nth-child(1) { width: 8%; } 
        thead tr:nth-child(2) th:nth-child(2) { width: 8%; } 
        thead tr:nth-child(2) th:nth-child(3) { width: 8%; } 
        thead th:nth-child(6) { width: 38%; } 

        thead {
            background-color: var(--primary-color);
            color: white;
            position: sticky; 
            top: 0;
            z-index: 10;
        }
        
        thead th {
            font-weight: 600;
            padding: 8px 3px; 
            border: none; 
            border-bottom: 1px solid #444444; 
        }

        th, td {
            padding: 6px 3px; 
            height: auto; 
            border: none; 
            border-bottom: 1px solid #eeeeee; 
        }
        
        .product-row:last-child td {
            border-bottom: none; 
        }
        
        /* Penataan Teks */
        .text-left {
            text-align: left;
            padding-left: 10px; 
        }
        .text-right {
            text-align: right;
            padding-right: 10px; 
            font-weight: 500;
        }

        /* Styling untuk Input QTY dan DISC (Lebih kecil) */
        .order-input, .disc-input {
            width: 100%; 
            max-width: 45px; 
            padding: 3px 1px; 
            font-size: 11px; 
            height: 24px; 
            margin: auto; 
            display: block; 
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
        }
        
        .disc-input {
            max-width: 40px;
        }
        
        /* Styling untuk Group Header (Pemisah Jelas) */
        .product-group-header td {
            background-color: var(--secondary-color) !important; 
            color: white;
            font-weight: 700;
            padding: 8px 10px !important; 
            border-bottom: none !important;
            box-shadow: 0 1px 0 rgba(255, 255, 255, 0.1) inset; 
        }
        
        /* ==================== 2. WARNA BERDASARKAN PRODUK (Soft Tones) ==================== */
        .KEM-TONE-EXT-row { background-color: #f9f9f9; } 
        .KEM-TONE-INT-row { background-color: #f9f9f9; } 
        .ULTRASHIELD-row { background-color: #f9f9f9; } 
        .SPECTRUM-row { background-color: #f9f9f9; } 
        .COLORTONE-EXT-row { background-color: #f9f9f9; } 
        .COLORTONE-INT-row { background-color: #f9f9f9; } 
        .SPECTRUM-SWOB-row { background-color: #f9f9f9; } 
        .SPECTRUM-ECO-row { background-color: #f9f9f9; } 
        .AEROSOL-row { background-color: #f9f9f9; } 
        .COLORANT-row { background-color: #f9f9f9; } 
        .ABC-row { background-color: #f9f9f9; } 
        /* ABC-ZINCHROMATE dihapus */
        .TAMITEX-CT-row { background-color: #f9f9f9; } 
        .TAMITEX-WF-row { background-color: #f9f9f9; } 
        .TAMITEX-CG-row { background-color: #f9f9f9; } 
        .VINOTEX-CT-row { background-color: #f9f9f9; } 
        .VINOTEX-WF-row { background-color: #f9f9f9; } 
        .APOLLO-row { background-color: #f9f9f9; } 
        /* SANLUX-ZINCHROMATE dihapus */
        .SPECTRUM-GRANITE-row { background-color: #f9f9f9; } 
        .SPECTRUM-FLOORKOTE-row { background-color: #f9f9f9; } 

    </style>
</head>
<body>

<div class="sales-order-container" id="sales-order-capture">
    <h2>SALES ORDER</h2> 
    
    <div class="header-info">
        <div class="info-row">
            <label for="nama-toko">Toko:</label>
            <input type="text" id="nama-toko" placeholder="Nama dan Alamat Toko">
        </div>
        <div class="info-row">
            <label for="salesman">Salesman:</label>
            <input type="text" id="salesman" placeholder="Nama Salesman">
        </div>
    </div>

    <div class="grand-total-top">
        <div class="grand-total-label">Grand Total</div>
        <div id="grand-total-display" class="grand-total-value">0</div>
    </div>
    
    <div class="filter-bar">
        <label for="filter-active">
            <input type="checkbox" id="filter-active"> 
            Tampilkan pesanan yang terisi
        </label>
        <button id="download-btn" disabled>Simpan</button>
    </div>
    
    <div class="table-wrapper" id="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th rowspan="2" class="text-left">PRODUK</th>
                    <th rowspan="2">DISC (%)</th>
                    <th colspan="3" class="header-group">ORDER (QTY)</th>
                    <th rowspan="2">TOTAL (RP)</th>
                </tr>
                <tr>
                    <th>KG</th>
                    <th>GLN</th>
                    <th>PL</th>
                </tr>
            </thead>
            <tbody id="product-list">
                </tbody>
        </table>
    </div>
</div>

<script>
    // Data Produk LENGKAP (SANLUX ZINCHROMATE & ABC ZINCHROMATE DIHAPUS)
    const productData = [
        // --- KEM-TONE EXT (Disc 17.5%) ---
        { produk: "KEM-TONE EXT", kategori: "WHITE EXT", hargaKg: 0, hargaGln: 563000, hargaPl: 2741300, disc: 17.5 },
        { produk: "KEM-TONE EXT", kategori: "ALKALI", hargaKg: 0, hargaGln: 425500, hargaPl: 1960400, disc: 17.5 },
        { produk: "KEM-TONE EXT", kategori: "TBM", hargaKg: 0, hargaGln: 483700, hargaPl: 2397500, disc: 17.5 },
        { produk: "KEM-TONE EXT", kategori: "UWE", hargaKg: 0, hargaGln: 495400, hargaPl: 2465100, disc: 17.5 },
        { produk: "KEM-TONE EXT", kategori: "DBO", hargaKg: 0, hargaGln: 449900, hargaPl: 2136400, disc: 17.5 },
        { produk: "KEM-TONE EXT", kategori: "NBT", hargaKg: 0, hargaGln: 396300, hargaPl: 1871800, disc: 17.5 },

        // --- KEM-TONE INT (Disc 17.5%) ---
        { produk: "KEM-TONE INT", kategori: "WHITE INT", hargaKg: 0, hargaGln: 381200, hargaPl: 1820600, disc: 17.5 },
        { produk: "KEM-TONE INT", kategori: "ALKALI", hargaKg: 0, hargaGln: 327600, hargaPl: 1511700, disc: 17.5 },
        { produk: "KEM-TONE INT", kategori: "TBA", hargaKg: 0, hargaGln: 339200, hargaPl: 1625900, disc: 17.5 },
        { produk: "KEM-TONE INT", kategori: "UWI", hargaKg: 0, hargaGln: 381200, hargaPl: 1846200, disc: 17.5 },
        { produk: "KEM-TONE INT", kategori: "DBC", hargaKg: 89800, hargaGln: 318200, hargaPl: 1455800, disc: 17.5 },
        { produk: "KEM-TONE INT", kategori: "NBD", hargaKg: 88600, hargaGln: 303100, hargaPl: 1435900, disc: 17.5 },
        { produk: "KEM-TONE INT", kategori: "3 IN 1", hargaKg: 0, hargaGln: 459300, hargaPl: 2167900, disc: 17.5 },
        { produk: "KEM-TONE INT", kategori: "ULTRA PRIMER", hargaKg: 0, hargaGln: 459300, hargaPl: 2167900, disc: 17.5 },
        { produk: "KEM-TONE INT", kategori: "CAT GYPSUM", hargaKg: 0, hargaGln: 242500, hargaPl: 1159700, disc: 17.5 },
        { produk: "KEM-TONE INT", kategori: "WALL FILLER", hargaKg: 0, hargaGln: 171400, hargaPl: 740100, disc: 17.5 },
        { produk: "KEM-TONE INT", kategori: "WALL SEALER (SOLVENT)", hargaKg: 0, hargaGln: 301900, hargaPl: 1389300, disc: 17.5 },
        { produk: "KEM-TONE INT", kategori: "PAINT REMOVER (SOLVENT)", hargaKg: 88600, hargaGln: 299600, hargaPl: 1456900, disc: 17.5 },
        { produk: "KEM-TONE INT", kategori: "TECHNIQUE GLAZE", hargaKg: 71100, hargaGln: 254100, hargaPl: 0, disc: 17.5 },
        { produk: "KEM-TONE INT", kategori: "RUSH REMOVER", hargaKg: 0, hargaGln: 271600, hargaPl: 1023400, disc: 17.5 },
        
        // --- ULTRASHIELD (Disc 15.0%) ---
        { produk: "ULTRASHIELD", kategori: "PUTIH", hargaKg: 0, hargaGln: 378200, hargaPl: 1802500, disc: 15.0 },
        { produk: "ULTRASHIELD", kategori: "ULTRA PRIMER", hargaKg: 0, hargaGln: 399700, hargaPl: 1903300, disc: 15.0 },
        { produk: "ULTRASHIELD", kategori: "TBM", hargaKg: 0, hargaGln: 361200, hargaPl: 1733400, disc: 15.0 },
        { produk: "ULTRASHIELD", kategori: "DBO", hargaKg: 0, hargaGln: 313700, hargaPl: 1499100, disc: 15.0 },
        { produk: "ULTRASHIELD", kategori: "NBT", hargaKg: 0, hargaGln: 308000, hargaPl: 1408500, disc: 15.0 },
        
        // --- SPECTRUM (Disc 15.0%) ---
        { produk: "SPECTRUM", kategori: "ALKALI", hargaKg: 0, hargaGln: 199300, hargaPl: 911500, disc: 15.0 },
        { produk: "SPECTRUM", kategori: "CAT GYPSUM", hargaKg: 0, hargaGln: 181200, hargaPl: 862800, disc: 15.0 },
        { produk: "SPECTRUM", kategori: "PUTIH", hargaKg: 0, hargaGln: 203800, hargaPl: 977100, disc: 15.0 },
        { produk: "SPECTRUM", kategori: "TBA", hargaKg: 0, hargaGln: 192500, hargaPl: 879800, disc: 15.0 },
        { produk: "SPECTRUM", kategori: "DBC", hargaKg: 48700, hargaGln: 166500, hargaPl: 755200, disc: 15.0 },
        { produk: "SPECTRUM", kategori: "NBD", hargaKg: 44200, hargaGln: 146100, hargaPl: 681600, disc: 15.0 },
        { produk: "SPECTRUM", kategori: "YB", hargaKg: 46500, hargaGln: 162000, hargaPl: 733700, disc: 15.0 },

        // --- COLORTONE EXT (Disc 12.5%) ---
        { produk: "COLORTONE EXT", kategori: "PUTIH EXT", hargaKg: 0, hargaGln: 208000, hargaPl: 947500, disc: 12.5 },
        { produk: "COLORTONE EXT", kategori: "TBM", hargaKg: 0, hargaGln: 167500, hargaPl: 803400, disc: 12.5 },
        { produk: "COLORTONE EXT", kategori: "DBO", hargaKg: 0, hargaGln: 143800, hargaPl: 675000, disc: 12.5 },
        { produk: "COLORTONE EXT", kategori: "NBT", hargaKg: 0, hargaGln: 133700, hargaPl: 626000, disc: 12.5 },

        // --- COLORTONE INT (Disc 14.5%) ---
        { produk: "COLORTONE INT", kategori: "ALKALI", hargaKg: 101400, hargaGln: 141100, hargaPl: 685400, disc: 14.5 },
        { produk: "COLORTONE INT", kategori: "PUTIH INT", hargaKg: 101400, hargaGln: 141100, hargaPl: 685400, disc: 14.5 },
        { produk: "COLORTONE INT", kategori: "TBA", hargaKg: 92100, hargaGln: 125900, hargaPl: 588600, disc: 14.5 },
        { produk: "COLORTONE INT", kategori: "DBC", hargaKg: 75800, hargaGln: 101400, hargaPl: 452300, disc: 14.5 },
        { produk: "COLORTONE INT", kategori: "NBD", hargaKg: 65300, hargaGln: 87500, hargaPl: 404500, disc: 14.5 },

        // --- SPECTRUM SW08 (Disc 10.0%) ---
        { produk: "SPECTRUM SW08", kategori: "ABU/PUTIH/OUTER SPACE", hargaKg: 65000, hargaGln: 245400, hargaPl: 1140000, disc: 15.0 },
        { produk: "SPECTRUM SW08", kategori: "MUDA", hargaKg: 56700, hargaGln: 203800, hargaPl: 1014500, disc: 15.0 },
        { produk: "SPECTRUM SW08", kategori: "NB", hargaKg: 51000, hargaGln: 180100, hargaPl: 852600, disc: 15.0 },

        // --- SPECTRUM ECO (Disc 15.0%) ---
        { produk: "SPECTRUM ECO", kategori: "ALKALI 18,9 L", hargaKg: 0, hargaGln: 0, hargaPl: 700700, disc: 15.0 },
        { produk: "SPECTRUM ECO", kategori: "ALKALI 3,78 L", hargaKg: 0, hargaGln: 147900, disc: 15.0 },
        { produk: "SPECTRUM ECO", kategori: "PUTIH & READY MIX 18,9 L", hargaKg: 0, hargaGln: 0, hargaPl: 765000, disc: 15.0 },
        { produk: "SPECTRUM ECO", kategori: "PUTIH & READY MIX 3,78 L", hargaKg: 0, hargaGln: 168300, disc: 15.0 },

        // --- AEROSOL (Disc 10.0%) ---
        { produk: "AEROSOL", kategori: "150 CC", hargaKg: 0, hargaGln: 16000, hargaPl: 0, disc: 10.0 },
        { produk: "AEROSOL", kategori: "300 CC", hargaKg: 0, hargaGln: 25000, hargaPl: 0, disc: 10.0 },

        // --- COLORANT (Disc 10.0%) ---
        { produk: "COLORANT", kategori: "RED", hargaKg: 0, hargaGln: 350900, hargaPl: 0, disc: 10.0 },
        { produk: "COLORANT", kategori: "RED OXIDE", hargaKg: 0, hargaGln: 214500, hargaPl: 0, disc: 10.0 },
        { produk: "COLORANT", kategori: "YELLOW", hargaKg: 0, hargaGln: 232000, hargaPl: 0, disc: 10.0 },
        { produk: "COLORANT", kategori: "YELLOW OXIDE", hargaKg: 0, hargaGln: 194700, hargaPl: 0, disc: 10.0 },
        { produk: "COLORANT", kategori: "BLUE", hargaKg: 0, hargaGln: 156200, hargaPl: 0, disc: 10.0 },
        { produk: "COLORANT", kategori: "GREEN", hargaKg: 0, hargaGln: 384100, hargaPl: 0, disc: 10.0 },
        { produk: "COLORANT", kategori: "VIOLET", hargaKg: 0, hargaGln: 202800, hargaPl: 0, disc: 10.0 },
        { produk: "COLORANT", kategori: "RAW UMBER", hargaKg: 0, hargaGln: 103800, hargaPl: 0, disc: 10.0 },
        { produk: "COLORANT", kategori: "MAGENTA", hargaKg: 0, hargaGln: 266900, hargaPl: 0, disc: 10.0 },
        { produk: "COLORANT", kategori: "BLACK", hargaKg: 0, hargaGln: 152700, hargaPl: 0, disc: 10.0 },
        { produk: "COLORANT", kategori: "WHITE", hargaKg: 0, hargaGln: 251800, hargaPl: 0, disc: 10.0 },
        { produk: "COLORANT", kategori: "RED ORANGE", hargaKg: 0, hargaGln: 589500, hargaPl: 0, disc: 10.0 },
        { produk: "COLORANT", kategori: "PREMIUM YELLOW", hargaKg: 0, hargaGln: 1392000, hargaPl: 0, disc: 10.0 },

        // --- ABC (Disc 10.0%) ---
        { produk: "ABC", kategori: "18,9 L", hargaKg: 0, hargaGln: 0, hargaPl: 1220900, disc: 10.0 },
        { produk: "ABC", kategori: "3,78 L", hargaKg: 0, hargaGln: 232300, disc: 10.0 },
        { produk: "ABC", kategori: "0,8 L", hargaKg: 0, hargaGln: 60100, disc: 10.0 },
        { produk: "ABC", kategori: "0,4 L", hargaKg: 0, hargaGln: 36000, disc: 10.0 },
        { produk: "ABC", kategori: "SILVER/COPPER 0,8 L", hargaKg: 0, hargaGln: 78500, disc: 10.0 },
        { produk: "ABC", kategori: "GOLD 0,8 L", hargaKg: 0, hargaGln: 120000, disc: 10.0 },
        
        // --- TAMITEX CT (Disc 10.0%) ---
        { produk: "TAMITEX CT", kategori: "23 KG", hargaKg: 0, hargaGln: 0, hargaPl: 515900, disc: 10.0 },
        { produk: "TAMITEX CT", kategori: "5 KG", hargaKg: 0, hargaGln: 112200, disc: 10.0 },
        { produk: "TAMITEX CT", kategori: "1 KG", hargaKg: 0, hargaGln: 27500, disc: 10.0 },

        // --- TAMITEX WF (Disc 10.0%) ---
        { produk: "TAMITEX WF", kategori: "23 KG", hargaKg: 0, hargaGln: 0, hargaPl: 304700, disc: 10.0 },
        { produk: "TAMITEX WF", kategori: "4 KG", hargaKg: 0, hargaGln: 59400, disc: 10.0 },
        { produk: "TAMITEX WF", kategori: "1 KG", hargaKg: 18700, hargaGln: 0, hargaPl: 0, disc: 10.0 },

        // --- TAMITEX CG (Disc 10.0%) ---
        { produk: "TAMITEX CG", kategori: "SPC 20 KG", hargaKg: 0, hargaGln: 0, hargaPl: 1269000, disc: 10.0 },
        { produk: "TAMITEX CG", kategori: "SPC 4 KG", hargaKg: 0, hargaGln: 254500, disc: 10.0 },
        { produk: "TAMITEX CG", kategori: "SPC 1 KG", hargaKg: 74800, hargaGln: 0, hargaPl: 0, disc: 10.0 },
        { produk: "TAMITEX CG", kategori: "STD 20 KG", hargaKg: 0, hargaGln: 0, hargaPl: 983500, disc: 10.0 },
        { produk: "TAMITEX CG", kategori: "STD 4 KG", hargaKg: 0, hargaGln: 199500, disc: 10.0 },
        { produk: "TAMITEX CG", kategori: "STD 1 KG", hargaKg: 62400, hargaGln: 0, hargaPl: 0, disc: 10.0 },
        
        // --- VINOTEX CT (Disc 10.0%) ---
        { produk: "VINOTEX CT", kategori: "STD & VIP 23 KG", hargaKg: 0, hargaGln: 0, hargaPl: 327800, disc: 10.0 },
        { produk: "VINOTEX CT", kategori: "STD & VIP 5 KG", hargaKg: 0, hargaGln: 78100, disc: 10.0 },
        { produk: "VINOTEX CT", kategori: "STD & VIP 1 KG", hargaKg: 20900, hargaGln: 0, hargaPl: 0, disc: 10.0 },
        { produk: "VINOTEX CT", kategori: "SPC 20 KG", hargaKg: 0, hargaGln: 0, hargaPl: 408500, disc: 10.0 },
        { produk: "VINOTEX CT", kategori: "SPC 4 KG", hargaKg: 0, hargaGln: 96400, disc: 10.0 },
        { produk: "VINOTEX CT", kategori: "SPC 1 KG", hargaKg: 26400, hargaGln: 0, hargaPl: 0, disc: 10.0 },


        // --- VINOTEX WF (Disc 10.0%) ---
        { produk: "VINOTEX WF", kategori: "23 KG", hargaKg: 0, hargaGln: 0, hargaPl: 232100, disc: 10.0 },
        { produk: "VINOTEX WF", kategori: "4 KG", hargaKg: 0, hargaGln: 49500, disc: 10.0 },
        { produk: "VINOTEX WF", kategori: "1 KG", hargaKg: 16500, hargaGln: 0, hargaPl: 0, disc: 10.0 },

        // --- APOLLO (Disc 10.0%) ---
        { produk: "APOLLO", kategori: "20 KG", hargaKg: 0, hargaGln: 0, hargaPl: 228900, disc: 10.0 },
        { produk: "APOLLO", kategori: "5 KG", hargaKg: 0, hargaGln: 59000, disc: 10.0 },
        
        // --- SPECTRUM GRANITE (Disc 10.0%) ---
        { produk: "SPECTRUM GRANITE", kategori: "GL", hargaKg: 0, hargaGln: 415000, hargaPl: 0, disc: 10.0 },
        { produk: "SPECTRUM GRANITE", kategori: "PL", hargaKg: 0, hargaGln: 0, hargaPl: 1950000, disc: 10.0 },

        // --- SPECTRUM FLOORKOTE (Disc 10.0%) ---
        { produk: "SPECTRUM FLOORKOTE", kategori: "20 KG", hargaKg: 0, hargaGln: 0, hargaPl: 1130000, disc: 10.0 },
        { produk: "SPECTRUM FLOORKOTE", kategori: "4 KG", hargaKg: 0, hargaGln: 250000, disc: 10.0 },
    ];
    
    // ==================== FUNGSI JAVASCRIPT (TIDAK ADA PERUBAHAN LOGIKA) ====================

    // 1. Fungsi Utility untuk format Rupiah
    function formatRupiah(number) {
        if (number === 0 || isNaN(number)) return '-'; 
        return Math.round(number).toLocaleString('id-ID', {
            minimumFractionDigits: 0
        });
    }
    
    // 2. Fungsi untuk membuat baris tabel dari data produk
    function createTableRows(data) {
        let html = '';
        let lastProduct = '';

        data.forEach((item) => {
            const cssClassName = item.produk.replace(/\s/g, '-').replace(/\//g, '-').toUpperCase();
            
            if (item.produk && item.produk !== lastProduct) {
                lastProduct = item.produk;
                const headerClassName = cssClassName + '-header';
                
                html += `<tr class="product-group-header ${headerClassName}">`;
                html += `<td colspan="5" class="group-label text-left">${item.produk}</td>`; 
                html += `<td class="text-right">-</td>`;
                html += `</tr>`;
            }
            
            let rowHtml = `<tr class="product-row ${cssClassName}-row">`; 
            
            rowHtml += `<td class="text-left">${item.kategori}</td>`; 
            
            // Input Diskon
            rowHtml += `<td><input type="number" min="0" max="100" value="${item.disc}" class="disc-input" step="0.5"></td>`;
            
            const disabledKg = item.hargaKg > 0 ? '' : 'disabled';
            const disabledGln = item.hargaGln > 0 ? '' : 'disabled';
            const disabledPl = item.hargaPl > 0 ? '' : 'disabled';

            // Input QTY
            rowHtml += `<td><input type="number" min="0" value="" ${disabledKg} class="order-input kg-qty" data-price="${item.hargaKg}"></td>`;
            rowHtml += `<td><input type="number" min="0" value="" ${disabledGln} class="order-input gln-qty" data-price="${item.hargaGln}"></td>`;
            rowHtml += `<td><input type="number" min="0" value="" ${disabledPl} class="order-input pl-qty" data-price="${item.hargaPl}"></td>`;

            rowHtml += `<td class="total-row text-right" data-total="0">-</td>`;

            rowHtml += `</tr>`;
            html += rowHtml;
        });

        document.getElementById('product-list').innerHTML = html;
        attachEventListeners();
    }
    
    // 3. Fungsi untuk menerapkan filter pada satu baris
    function applyRowFilter(row, total) {
        const filterActive = document.getElementById('filter-active').checked;
        const isProductRow = row.classList.contains('product-row');

        if (filterActive) {
            if (isProductRow && total === 0) {
                row.style.display = 'none'; 
            } else {
                row.style.display = ''; 
            }
            
            if (row.classList.contains('product-group-header')) {
                 row.style.display = '';
            }
        } else {
            row.style.display = ''; 
        }
    }

    // 4. Fungsi Utama untuk menghitung Total per Baris
    function calculateRow(row) {
        
        const inputKg = row.querySelector('.kg-qty');
        const inputGln = row.querySelector('.gln-qty');
        const inputPl = row.querySelector('.pl-qty');
        const inputDisc = row.querySelector('.disc-input'); 

        if (!inputKg) return; 

        const hargaKg = parseFloat(inputKg.dataset.price) || 0;
        const qtyKg = parseFloat(inputKg.value) || 0; 

        const hargaGln = parseFloat(inputGln.dataset.price) || 0;
        const qtyGln = parseFloat(inputGln.value) || 0;

        const hargaPl = parseFloat(inputPl.dataset.price) || 0;
        const qtyPl = parseFloat(inputPl.value) || 0;
        
        const discPercent = parseFloat(inputDisc.value) || 0; 
        const diskon = discPercent / 100;

        const subTotal = (hargaKg * qtyKg) + (hargaGln * qtyGln) + (hargaPl * qtyPl);
        
        let total = subTotal * (1 - diskon);
        total = Math.round(total); 

        const totalDisplayElement = row.querySelector('.total-row');
        totalDisplayElement.dataset.total = total; 
        totalDisplayElement.textContent = formatRupiah(total);

        applyRowFilter(row, total);
        
        calculateGrandTotal();
    }

    // 5. Fungsi untuk menghitung Grand Total DAN MENYETEL STATUS TOMBOL
    function calculateGrandTotal() {
        let grandTotal = 0;
        const totalElements = document.querySelectorAll('.total-row');
        const grandTotalDisplay = document.getElementById('grand-total-display');
        const downloadBtn = document.getElementById('download-btn'); 
        
        totalElements.forEach(element => {
            const row = element.closest('.product-row');
            
             if (row.style.display !== 'none') {
                const total = parseFloat(element.dataset.total) || 0;
                grandTotal += total;
            }
        });

        grandTotalDisplay.textContent = formatRupiah(grandTotal);

        if (grandTotal === 0) {
            downloadBtn.disabled = true;
        } else {
            downloadBtn.disabled = false;
        }
    }

    // 6. Fungsi untuk men-toggle filter (Termasuk logika untuk header grup)
    function toggleFilter() {
        const allRows = document.querySelectorAll('#product-list > tr');
        
        allRows.forEach(row => {
            if (row.classList.contains('product-row')) {
                const totalString = row.querySelector('.total-row').dataset.total;
                const total = parseFloat(totalString) || 0;
                applyRowFilter(row, total);
            }
        });

        const filterActive = document.getElementById('filter-active').checked;
        let visibleProductGroups = {}; 

        // Tentukan grup mana yang memiliki produk terlihat
        document.querySelectorAll('.product-row').forEach(row => {
            if (row.style.display !== 'none') {
                const productClass = row.classList[1].replace('-row', ''); 
                visibleProductGroups[productClass] = true;
            }
        });
        
        // Sembunyikan atau tampilkan header grup
        document.querySelectorAll('.product-group-header').forEach(headerRow => {
            const productClass = headerRow.classList[1].replace('-header', '');
            if (filterActive && !visibleProductGroups[productClass]) {
                headerRow.style.display = 'none';
            } else {
                headerRow.style.display = '';
            }
        });
        
        calculateGrandTotal(); 
    }
    
    // 7. FUNGSI DOWNLOAD KE GALERI
    async function downloadToGallery() {
        const btn = document.getElementById('download-btn');
        if (btn.disabled) {
             alert("Grand Total masih kosong. Mohon isi pesanan terlebih dahulu.");
             return; 
        }

        const container = document.getElementById('sales-order-capture');
        const tableWrapper = document.getElementById('table-wrapper');
        const namaToko = document.getElementById('nama-toko').value.trim() || "SO"; 
        
        // --- 1. SIAPKAN TAMPILAN UNTUK CAPTURE ---
        const originalBtnDisplay = btn.style.display;
        
        const originalWrapperMaxHeight = tableWrapper.style.maxHeight;
        const originalWrapperOverflow = tableWrapper.style.overflowY;
        const filterCheckbox = document.getElementById('filter-active');
        const originalFilterState = filterCheckbox.checked;

        // Sembunyikan tombol download
        btn.style.display = 'none'; 
        
        // Pastikan seluruh tabel terlihat tanpa scroll
        tableWrapper.style.maxHeight = 'initial';
        tableWrapper.style.overflowY = 'initial';

        // Aktifkan filter agar hanya pesanan terisi yang terekam
        filterCheckbox.checked = true;
        toggleFilter(); 

        await new Promise(resolve => setTimeout(resolve, 100)); 


        try {
            // --- 2. KONVERSI MENGGUNAKAN HTML2CANVAS ---
            const canvas = await html2canvas(container, {
                scale: 3, 
                allowTaint: true,
                useCORS: true,
                backgroundColor: '#ffffff', 
            });

            // --- 3. PROSES UNDUH FILE ---
            
            const imageURL = canvas.toDataURL('image/png');
            
            const downloadLink = document.createElement('a');
            downloadLink.href = imageURL;
            downloadLink.download = `SO_${namaToko.replace(/\s/g, '_').replace(/[^a-zA-Z0-9_]/g, '')}_${new Date().toISOString().slice(0, 10)}.png`;
            
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);

            // --- 4. POP UP KONFIRMASI ---
            alert("Gambar Sales Order berhasil tersimpan di galeri (Unduhan).");

        } catch (error) {
            console.error("Gagal membuat atau mengunduh gambar SO:", error);
            alert("Gagal membuat gambar SO. Pastikan browser Anda mendukung fungsi ini atau coba lagi.");
        } finally {
            // --- 5. KEMBALIKAN TAMPILAN KE KONDISI SEMULA ---
            filterCheckbox.checked = originalFilterState;
            toggleFilter(); 

            btn.style.display = originalBtnDisplay;
            tableWrapper.style.maxHeight = originalWrapperMaxHeight;
            tableWrapper.style.overflowY = originalWrapperOverflow;
            calculateGrandTotal(); 
        }
    }


    // 8. Fungsi untuk melampirkan Event Listener ke input
    function attachEventListeners() {
        const qtyInputs = document.querySelectorAll('.order-input');
        const discInputs = document.querySelectorAll('.disc-input');
        const filterCheckbox = document.getElementById('filter-active');
        const downloadBtn = document.getElementById('download-btn');
        
        // Listener untuk Input QTY dan DISC
        [...qtyInputs, ...discInputs].forEach(input => {
            input.addEventListener('input', function() {
                // Batasan nilai input
                if (this.classList.contains('disc-input')) {
                    if (parseFloat(this.value) < 0) this.value = 0; 
                    if (parseFloat(this.value) > 100) this.value = 100; 
                } else if (parseFloat(this.value) < 0) {
                    this.value = 0; 
                }
                const row = this.closest('.product-row');
                calculateRow(row);
            });
            // Hitung sekali saat awal load
            const row = input.closest('.product-row');
            calculateRow(row);
        });
        
        // Listener untuk Filter
        if (filterCheckbox) {
            filterCheckbox.addEventListener('change', toggleFilter);
        }
        
        // Listener untuk tombol Download
        if (downloadBtn) {
            downloadBtn.addEventListener('click', downloadToGallery);
        }
    }

    // 9. Jalankan fungsi utama saat dokumen dimuat
    document.addEventListener('DOMContentLoaded', () => {
        createTableRows(productData);
    });
</script>
</body>
</html>



